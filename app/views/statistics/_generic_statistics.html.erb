  <%
    authors = facet_items('author_facet')
    dates = facet_items('pub_date_facet')
    genre = facet_items('genre_facet')
    subject = facet_items('subject_facet')
    resource_type = facet_items('type_of_resource_facet')
    media_type = facet_items('media_type_facet')
    organization = facet_items('organization_facet')
    department = facet_items('department_facet')
    series = facet_items('series_facet')
    non_cu_series = facet_items('non_cu_series_facet')
  %>
  
    <style>
      .facet_items {
           width: 450px;
        }
        
       .facet_name {
       		padding: 0 0 0 0;
       } 
       
       .facet_num {
       	text-align: right;
       	padding: 0 40px 0 0;
       } 
    </style>  

<div style='float:left;'><h3>Common Statistics</h3></div>

<br style="clear:both"/>

<div style='padding: 0px 0px;'>
    <div style='display: table; width: 100%;'>
    	
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell g_stat_head_cell' style='display: table-cell; min-width: 210px; padding: 20px 15px 15px 10px;'>
        	
        </div>
        <div class='table-cell' style='display: table-cell;  '>
        	<div style='display: table; width: ;'>
        		<div style='display: table-row;'>
					<div class='table-cell g_stat_head_cell' style='display: table-cell;'>
						    DOCS
					</div>
				 	<div class='table-cell g_stat_head_cell' style='display: table-cell;'>
				            VIEWS
					</div>
					<div class='table-cell g_stat_head_cell' style='display: table-cell;'>
				            DOWNLOADS
					</div>
					<div class='table-cell g_stat_head_cell' style='display: table-cell;'>
				            STREAMS
					</div>

				</div>		            
			</div>
		</div>  
      </div>  

       <div style='display: table-row; width: 100%;'>
        <div class='table-cell g_stat_head_cell' style='display: table-cell; min-width: 230px; padding: 20px 5px 15px 0px;'>
        	<nobr>
        	PID: 
        	&nbsp;
        	<input type="text" style="width:80px; text-align:center" id="single-pid">
        	&nbsp;
        	<input type="submit" id="pid-statistics-button" value=" get statistics: " onclick="get_single_stats();">
        	</nobr>
        </div>
        <div class='table-cell' style='display: table-cell;  '>
        	<div style='display: table; width: ;'>
        		<div style='display: table-row;'>
					<div id='pid-docs-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
						    
					</div>
				 	<div id='pid-views-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
				            
					</div>
					<div id='pid-downloads-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
				            
					</div>
					<div id='pid-streams-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
				           
					</div>

				</div>		            
			</div>
		</div>  
      </div>     

        <div style='display: table-row; width: 100%;'>
	        <div class='table-cell' style='display: table-cell;'>
				<hr>
	        </div>   
            <div class='table-cell' style='display: table-cell;'>
				<hr>
	        </div>  
		</div>
		
       <div style='display: table-row; width: 100%; height: 60px;'>
        <div class='table-cell g_stat_head_cell' style='display: table-cell; min-width: 230px; padding: 20px 5px 15px 0px;'>
            <a id="search_link" href="" style=" visibility: hidden;">search link</a>
        </div>
        <div class='table-cell' style='display: table-cell;  '>
        	<div style='display: table; width: ;'>
        		<div style='display: table-row;'>
					<div id='facet-docs-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
						    
					</div>
				 	<div id='facet-views-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>

					</div>
					<div id='facet-downloads-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>

					</div>
					<div id='facet-streams-size' class='table-cell g_stat_head_cell' style='display: table-cell;'>
				           
					</div>

				</div>		            
			</div>
		</div>  
      </div> 

    </div>
    

     <div style='display: table; width: 100%;'>
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;'>
			Author
		</div>  
        <div class='table-cell facet_num' style='display: table-cell;'>
			(<%= (authors.size - 1).to_s %>)
		</div>  
        <div class='table-cell' style='display: table-cell;'>
 			<%= select_tag 'author_facet', options_for_select(authors), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;'>
			Date 
		</div>  
        <div class='table-cell facet_num' style='display: table-cell;'>
			(<%= (dates.size - 1).to_s %>)
		</div>  		
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'pub_date_facet', options_for_select(dates), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Content Type
		</div>  
		 <div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (genre.size - 1).to_s %>)
		</div>  
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'genre_facet', options_for_select(genre), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Subject
		</div>  
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (subject.size - 1).to_s %>)
		</div>
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'subject_facet', options_for_select(subject), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Resource Type 
		</div> 
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (resource_type.size - 1).to_s %>)
		</div> 
		 
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'type_of_resource_facet', options_for_select(resource_type), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Media Type
		</div>  
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (media_type.size - 1).to_s %>)
		</div>  
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'media_type_facet', options_for_select(media_type), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Organization
		</div>
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (organization.size - 1).to_s %>)
		</div>   
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'organization_facet', options_for_select(organization), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Department
		</div>  
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (department.size - 1).to_s %>)
		</div> 
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'department_facet', options_for_select(department), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Series
		</div>
		<div class='table-cell facet_num' style='display: table-cell;  '>
			(<%= (series.size - 1).to_s %>)
		</div>   
        <div class='table-cell' style='display: table-cell;  '>
 			<%= select_tag 'series_facet', options_for_select(series), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 
      
      <div style='display: table-row; width: 100%;'>
        <div class='table-cell facet_name' style='display: table-cell;  '>
			Non CU Series 
		</div>
		<div class='table-cell facet_num' style='display: table-cell;'>
			(<%= (non_cu_series.size - 1).to_s %>)
		</div>   
        <div class='table-cell' style='display: table-cell; '>
 			<%= select_tag 'non_cu_series_facet', options_for_select(non_cu_series), :class => 'facet_items', :onChange=>"javascript: hide_facet_results();" %>
		</div>  
      </div> 

    </div>

</div>


<br style="clear:both"/>



	<div>
		<input id="facet-statistics-button" type="submit" value=" get statistics: " onclick="get_facet_stats();">
	</div>


<script>

    var in_process = false;
    
	var docs_finished = false;
	var views_finished = false;
	var downloads_finished = false;
	var streams_finished = false;
    
    var facets = new Array();
    facets['authors'] = 'author_facet';
	facets['pub_dates'] = 'pub_date_facet';
	facets['genre'] = 'genre_facet';
	facets['subjects'] = 'subject_facet';
	facets['type_of_resources'] = 'type_of_resource_facet';
	facets['media_types'] = 'media_type_facet';
	facets['organizations'] = 'organization_facet';
	facets['departments'] = 'department_facet';
	facets['series'] = 'series_facet';
	facets['non_cu_series'] = 'non_cu_series_facet';

function hide_facet_results(){
	document.getElementById( "search_link" ).style.visibility = 'hidden';
	document.getElementById( "facet-docs-size" ).style.visibility = 'hidden';
    document.getElementById( "facet-views-size" ).style.visibility = 'hidden';
    document.getElementById( "facet-downloads-size" ).style.visibility = 'hidden';
    document.getElementById( "facet-streams-size" ).style.visibility = 'hidden';
}

function get_facet_stats(){
	
	if(in_process) {
		return;
	} 
	
	in_process = true;
		
	docs_finished = false;
	views_finished = false;
	downloads_finished = false;
	streams_finished = false;

    disableOrEnableElements (facets , true);
    
    document.getElementById( "facet-statistics-button" ).disabled = true; 
    
    document.getElementById( "facet-docs-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "facet-docs-size" ).style.visibility = 'visible';
    
    document.getElementById( "facet-views-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "facet-views-size" ).style.visibility = 'visible';   
    
    document.getElementById( "facet-downloads-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "facet-downloads-size" ).style.visibility = 'visible';   
    
    document.getElementById( "facet-streams-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "facet-streams-size" ).style.visibility = 'visible';       
    
    document.getElementById( "facet-statistics-button" ).disabled = true; 

	var author_facet_value = document.getElementById( facets['authors'] ).value;
	var pub_date_facet_value = document.getElementById( facets['pub_dates'] ).value;
	var genre_facet_value = document.getElementById( facets['genre'] ).value;
	var subject_facet_value = document.getElementById( facets['subjects'] ).value;
	var type_of_resource_facet_value = document.getElementById( facets['type_of_resources'] ).value;
	var media_type_facet_value = document.getElementById( facets['media_types'] ).value;
	var organization_facet_value = document.getElementById( facets['organizations'] ).value;
	var department_facet_value = document.getElementById( facets['departments'] ).value;
	var series_facet_value = document.getElementById( facets['series'] ).value;
	var non_cu_series_facet_value = document.getElementById( facets['non_cu_series'] ).value;
	
	var search_params = "";
	
	if(author_facet_value) { search_params = search_params + "&f[" + facets['authors'] + "][]=" + author_facet_value}
	if(pub_date_facet_value) { search_params = search_params + "&f[" + facets['pub_dates'] + "][]=" + pub_date_facet_value}
	if(genre_facet_value) { search_params = search_params + "&f[" + facets['genre'] + "][]=" + genre_facet_value}
	if(subject_facet_value) { search_params = search_params + "&f[" + facets['subjects'] + "][]=" + subject_facet_value}
	if(type_of_resource_facet_value) { search_params = search_params + "&f[" + facets['type_of_resources'] + "][]=" + type_of_resource_facet_value }
	if(media_type_facet_value) { search_params = search_params + "&f[" + facets['media_types'] + "][]=" + media_type_facet_value}
	if(organization_facet_value) { search_params = search_params + "&f[" + facets['organizations'] + "][]=" + organization_facet_value}
	if(department_facet_value) { search_params = search_params + "&f[" + facets['departments'] + "][]=" + department_facet_value}
	if(series_facet_value) { search_params = search_params + "&f[" + facets['series'] + "][]=" + series_facet_value}
	if(non_cu_series_facet_value) { search_params = search_params + "&f[" + facets['non_cu_series'] + "][]=" + non_cu_series_facet_value}
	
	  
	  document.getElementById( "search_link" ).style.visibility ='visible';
	  document.getElementById( "search_link" ).href = '/?' + search_params;

	  $.ajax({url: "/statistics/docs_size_by_query_facets/?" + search_params + "",
           success: function(data) {
             $("#facet-docs-size").html(data);
			 document.getElementById( "facet-docs-size" ).style.visibility = 'visible';
	         docs_finished = true;
             makeFasetStatsButtonAvailable(docs_finished, views_finished, downloads_finished, streams_finished, facets);
           }
      });
  
	  $.ajax({url: "/statistics/facetStatsByEvent/?" + search_params + "&event=View",
           success: function(data) {
             $("#facet-views-size").html(data);
			 document.getElementById( "facet-views-size" ).style.visibility = 'visible';
			 views_finished = true;
             makeFasetStatsButtonAvailable(docs_finished, views_finished, downloads_finished, streams_finished, facets);
           }
      });
      
	  $.ajax({url: "/statistics/facetStatsByEvent/?" + search_params + "&event=Download",
           success: function(data) {
             $("#facet-downloads-size").html(data);
			 document.getElementById( "facet-downloads-size" ).style.visibility = 'visible';
			 downloads_finished = true;
	         makeFasetStatsButtonAvailable(docs_finished, views_finished, downloads_finished, streams_finished, facets);
           }
      });
      
	  $.ajax({url: "/statistics/facetStatsByEvent/?" + search_params + "&event=Streaming",
           success: function(data) {
             $("#facet-streams-size").html(data);
			 document.getElementById( "facet-streams-size" ).style.visibility = 'visible';
			 streams_finished = true;
			 makeFasetStatsButtonAvailable(docs_finished, views_finished, downloads_finished, streams_finished, facets);
           }
      });
      
}

function makeFasetStatsButtonAvailable(docs_finished, views_finished, downloads_finished, streams_finished, facets){

	if(docs_finished && views_finished && downloads_finished && streams_finished){

		document.getElementById( "facet-statistics-button" ).disabled = false;
		disableOrEnableElements (facets, false);
        in_process = false;
	  }
}

function disableOrEnableElements (element_names, argument) {
  for (var name in element_names) {
	document.getElementById( element_names[name] ).disabled = argument;
  }
}

	var pid_docs_finished = false;
	var pid_views_finished = false;
	var pid_downloads_finished = false;
	var pid_streams_finished = false;
	
function makeSinglePidStatsButtonAvailable(pid_docs_finished, pid_views_finished, pid_downloads_finished, pid_streams_finished){

	if(pid_docs_finished && pid_views_finished && pid_downloads_finished && pid_streams_finished){

	  document.getElementById( 'pid-statistics-button' ).disabled = false;
	  document.getElementById( 'single-pid' ).disabled = false;
	}
}

function get_single_stats(){
	
	document.getElementById( 'pid-statistics-button' ).disabled = true;
	document.getElementById( 'single-pid' ).disabled = true;
	
	document.getElementById( "pid-docs-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "pid-views-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "pid-downloads-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';
    document.getElementById( "pid-streams-size" ).innerHTML = '<img id="facet-docs-size-spin" src="/assets/16px_on_transparent.gif"/>';	

  var pid = document.getElementById('single-pid').value;

  $.ajax({url: '/statistics/single_pid_count/?pid=' + pid,
           success: function(data) {
             $("#pid-docs-size").html(data);
             document.getElementById( "pid-docs-size" ).style.visibility = 'visible';
             pid_docs_finished = true;
             makeSinglePidStatsButtonAvailable(pid_docs_finished, pid_views_finished, pid_downloads_finished, pid_streams_finished);
           }
  });

  $.ajax({url: '/statistics/single_pid_stats/?event=View&pid=' + pid,
           success: function(data) {
             $("#pid-views-size").html(data);
             document.getElementById( "pid-views-size" ).style.visibility = 'visible';
             pid_views_finished = true;
             makeSinglePidStatsButtonAvailable(pid_docs_finished, pid_views_finished, pid_downloads_finished, pid_streams_finished);
           }
  });
  
  $.ajax({url: '/statistics/single_pid_stats/?event=Download&pid=' + pid,
           success: function(data) {
             $("#pid-downloads-size").html(data);
             document.getElementById( "pid-downloads-size" ).style.visibility = 'visible';
             pid_downloads_finished = true;
             makeSinglePidStatsButtonAvailable(pid_docs_finished, pid_views_finished, pid_downloads_finished, pid_streams_finished);
           }
  });  
  
  $.ajax({url: '/statistics/single_pid_stats/?event=Streaming&pid=' + pid,
           success: function(data) {
             $("#pid-streams-size").html(data);
             document.getElementById( "pid-streams-size" ).style.visibility = 'visible';
             pid_streams_finished = true;
             makeSinglePidStatsButtonAvailable(pid_docs_finished, pid_views_finished, pid_downloads_finished, pid_streams_finished);
           }
  });  
  
}
</script>
