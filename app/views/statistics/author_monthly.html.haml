%h3 Author Monthly Statistics
.split_form

  -form_tag url_for(:controller => "statistics", :action => "author_monthly") do

    .label Author uni:
    .value= text_field_tag :author_id, params[:author_id]

    .label Email Template:
    .value
      = select_tag :email_template, options_for_select(["Normal", "Initial"], params[:email_template] || "Normal")
    
    .label Report month:
    .value
      = select_tag :month, options_for_select(Date::ABBR_MONTHNAMES, params[:month] || (Date.today - 1.months).strftime("%b"))
      = select_tag :year, options_for_select((2011..Date.today.year), params[:year])

    .label Include zeroes?
    .value
      = check_box_tag :include_zeroes, "true", params[:include_zeroes]

    .label 
    .value
      = submit_tag "View"


    - if @results
      %hr 

      %table#author_stats_results
        %tr
          %th Title
          %th Views
          %th Downloads

        %tr
          %td 
            %b Total for #{params[:month]} #{params[:year]}
          %td= @totals["View"] || 0
          %td= @totals["Download"] || 0

        - @results.each do |item|
          %tr
            %td= link_to item["title_display"], catalog_path(item["id"])
            %td= @stats["View"][item["id"]] || 0
            %td= @stats["Download"][item["id"]] || 0


      .label
      .value

      .label Email to:
      .value
        = text_field_tag :email_destination, params[:email_destination], :size => 40
        = submit_tag "Email"

      = render :partial => "/debug_deliveries"
