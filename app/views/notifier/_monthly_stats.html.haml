%br

%div 
  Usage Statistics:
- unless @results.empty?
  %table
    -if lifetime
      %tr
        %td
        %td{:colspan => 3, :align => "center"} This Month 
        %td{:colspan => 3, :align => "center"} Lifetime 
    %tr
      %td 
      %td{:style=>"padding: 0px 10px 0px"} 
        %b Views
      %td{:style=>"padding: 0px 10px 0px"} 
        %b Downloads
      %td{:style=>"padding: 0px 10px 0px"} 
        %b Streaming        
      - if lifetime
        %td{:style=>"padding: 0px 10px 0px 20px"} 
          %b Views
        %td{:style=>"padding: 0px 10px 0px"}
          %b Downloads
        %td{:style=>"padding: 0px 10px 0px"} 
          %b Streaming  

    -current_url = (Rails.application.config.base_path != nil) ? Rails.application.config.base_path : "localhost:3000"
    -current_url = "#{current_url}#{Rails.application.config.relative_root}"
    - @results.each_with_index do |item, i|
      - views =  @stats["View"][item["id"][0]] || 0
      - lifetime_views = @stats["View Lifetime"][item["id"][0]] || 0
      - downloads =  @stats["Download"][item["id"][0]] || 0
      - lifetime_downloads = @stats["Download Lifetime"][item["id"][0]] || 0
      - streaming = @stats["Streaming"][item["id"][0]] || 0
      - lifetime_streaming = @stats["Streaming Lifetime"][item["id"][0]] || 0
      %tr
        %td= link_to(item["title_display"], url_for(:host => current_url,  :only_path => false, :controller => :catalog, :action => :show, :id => item["id"])) 
        %td{:style=>"padding: 0px 10px 0px"}
          #{views}
        %td{:style=>"padding: 0px 10px 0px"}
          #{downloads}
        %td{:style=>"padding: 0px 10px 0px"}
          #{streaming}
        -if lifetime
          %td{:style=>"padding: 0px 10px 0px 20px"}
            #{lifetime_views}
          %td{:style=>"padding: 0px 10px 0px"}
            #{lifetime_downloads}
          %td{:style=>"padding: 0px 10px 0px"}
            #{lifetime_streaming}
    %tr
      %td
        %b Totals: 
      %td{:style=>"padding: 0px 10px 0px"}
        %b #{@totals["View"]}
      %td{:style=>"padding: 0px 10px 0px"}
        %b #{@totals["Download"]}
      %td{:style=>"padding: 0px 10px 0px"}
        %b #{@totals["Streaming"]} 
      - if lifetime
        %td{:style=>"padding: 0px 10px 0px 20px"}
          %b #{@totals["View Lifetime"]}
        %td{:style=>"padding: 0px 10px 0px"}
          %b #{@totals["Download Lifetime"]}
        %td{:style=>"padding: 0px 10px 0px"}
          %b #{@totals["Streaming Lifetime"]}

  %br

  %div Views are the number of times someone has looked at the record for your item in Academic Commons.  Downloads are the number of times someone has accessed the deposited file.

  %br

- else
  No views or downloads for your items during this time period.

%br
